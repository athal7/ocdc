# yaml-language-server: $schema=../repos-config.schema.json
#
# Repository Configuration for Self-Iteration
#
# This file configures per-repository settings for automatic issue
# readiness evaluation. When self-iteration is enabled, ocdc will
# evaluate issues and optionally mark them as ready.
#
# Location: ~/.config/ocdc/repos.yaml
#
# Prerequisites:
# - Enable self-iteration in ~/.config/ocdc/config.json:
#   {
#     "self_iteration": {
#       "enabled": true,
#       "ready_label": "ocdc:ready"
#     }
#   }
# - MCP server configured for your issue tracker (github or linear)

repos:
  # ==========================================================================
  # GitHub Example - Full configuration
  # ==========================================================================
  myorg/backend:
    # Local path to the repository (required)
    repo_path: ~/code/backend
    
    # Issue tracker configuration - uses MCP to fetch issues
    issue_tracker:
      # MCP source type: github_issue or linear_issue
      source_type: github_issue
      
      # Options passed to MCP fetch (varies by source type)
      # See share/ocdc/examples/*.yaml for fetch option examples
      fetch_options:
        repo: myorg/backend
        state: open
        # labels: ["bug", "enhancement"]  # Optional: filter by labels
      
      # Action when marking an issue as ready
      ready_action:
        type: add_label           # add_label or none
        label: "ocdc:ready"       # Label to add (defaults to global ready_label)
    
    # Readiness evaluation criteria
    readiness:
      labels:
        # Issues with these labels are excluded
        exclude:
          - blocked
          - needs-design
          - needs-review
          - wontfix
      
      # Priority scoring - higher scores get picked first
      priority:
        labels:
          - label: critical
            weight: 100
          - label: high
            weight: 50
          - label: medium
            weight: 25
          - label: low
            weight: 10
        # Bonus points per day since issue creation (FIFO preference)
        age_weight: 1
      
      # Dependency detection
      dependencies:
        # Check issue body for "blocked by #X" patterns
        check_body_references: true
        # Labels that indicate the issue is blocked
        blocking_labels:
          - blocked
          - waiting-on-external
    
    # WIP (Work In Progress) limits for this repo
    wip_limits:
      max_concurrent: 2

  # ==========================================================================
  # GitHub Example - Minimal configuration (uses defaults)
  # ==========================================================================
  myorg/frontend:
    repo_path: ~/code/frontend
    issue_tracker:
      source_type: github_issue
      fetch_options:
        repo: myorg/frontend

  # ==========================================================================
  # Linear Example
  # ==========================================================================
  # Linear issues are typically picked up by workflow state rather than labels,
  # so ready_action is set to "none". The poller finds issues in the appropriate
  # state (e.g., "In Progress", "Started") without needing to add labels.
  #
  # Prerequisites:
  # - MCP server 'linear' configured in ~/.config/opencode/opencode.json:
  #   {
  #     "mcp": {
  #       "linear": {
  #         "type": "remote",
  #         "url": "https://mcp.linear.app/sse",
  #         "enabled": true,
  #         "headers": {
  #           "Authorization": "Bearer ${LINEAR_API_TOKEN}"
  #         }
  #       }
  #     }
  #   }
  
  myorg/linear-project:
    repo_path: ~/code/linear-project
    issue_tracker:
      source_type: linear_issue
      fetch_options:
        team: "ENG"               # Linear team key
        assignee: "@me"           # Issues assigned to you
        # state: ["started", "unstarted"]  # Optional: filter by state
      ready_action:
        type: none                # Linear uses workflow states, not labels
    
    readiness:
      labels:
        exclude:
          - blocked
      priority:
        labels:
          - label: Urgent
            weight: 100
          - label: High
            weight: 50
    
    wip_limits:
      max_concurrent: 1
