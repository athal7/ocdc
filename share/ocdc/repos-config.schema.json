{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/athal7/ocdc/repos-config.schema.json",
  "title": "OCDC Repository Configuration",
  "description": "Configuration schema for repository settings used by self-iteration",
  "type": "object",
  "required": ["repos"],
  "properties": {
    "repos": {
      "type": "object",
      "description": "Map of repository keys to their configuration",
      "additionalProperties": {
        "$ref": "#/$defs/RepoConfig"
      }
    }
  },
  "$defs": {
    "RepoConfig": {
      "type": "object",
      "required": ["repo_path"],
      "properties": {
        "repo_path": {
          "type": "string",
          "description": "Local filesystem path to the repository (supports ~ expansion)"
        },
        "issue_tracker": {
          "type": "object",
          "description": "Issue tracker configuration for fetching issues via MCP",
          "properties": {
            "source_type": {
              "type": "string",
              "enum": ["github_issue", "linear_issue"],
              "default": "github_issue",
              "description": "MCP source type for fetching issues"
            },
            "fetch_options": {
              "type": "object",
              "description": "Options passed to MCP fetch (repo, team, assignee, state, labels, etc.)",
              "additionalProperties": true
            },
            "ready_action": {
              "type": "object",
              "description": "Action to take when marking an issue as ready",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["add_label", "none"],
                  "default": "add_label",
                  "description": "Action type: add_label (GitHub) or none (Linear)"
                },
                "label": {
                  "type": "string",
                  "description": "Label to add (for add_label type)"
                }
              }
            }
          }
        },
        "readiness": {
          "type": "object",
          "description": "Criteria for determining issue readiness",
          "properties": {
            "labels": {
              "type": "object",
              "properties": {
                "required": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": [],
                  "description": "Labels that must ALL be present"
                },
                "any_of": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": [],
                  "description": "At least ONE of these labels must be present"
                },
                "exclude": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": [],
                  "description": "Labels that must NOT be present"
                }
              }
            },
            "priority": {
              "type": "object",
              "properties": {
                "labels": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["label", "weight"],
                    "properties": {
                      "label": {
                        "type": "string",
                        "description": "Label name"
                      },
                      "weight": {
                        "type": "integer",
                        "description": "Priority weight (higher = more important)"
                      }
                    }
                  },
                  "description": "Labels with priority weights"
                },
                "age_weight": {
                  "type": "number",
                  "default": 1,
                  "description": "Points added per day since issue creation"
                }
              }
            },
            "dependencies": {
              "type": "object",
              "properties": {
                "check_body_references": {
                  "type": "boolean",
                  "default": true,
                  "description": "Check issue body for 'blocked by #X' patterns"
                },
                "blocking_labels": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": ["blocked"],
                  "description": "Labels that indicate blocking"
                }
              }
            }
          }
        },
        "wip_limits": {
          "type": "object",
          "properties": {
            "max_concurrent": {
              "type": "integer",
              "default": 3,
              "description": "Maximum concurrent sessions for this repository"
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "repos": {
        "myorg/backend": {
          "repo_path": "~/code/backend",
          "issue_tracker": {
            "source_type": "github_issue",
            "fetch_options": {
              "repo": "myorg/backend",
              "state": "open"
            },
            "ready_action": {
              "type": "add_label",
              "label": "ocdc:ready"
            }
          },
          "wip_limits": {
            "max_concurrent": 2
          }
        }
      }
    },
    {
      "repos": {
        "myorg/frontend": {
          "repo_path": "~/code/frontend",
          "issue_tracker": {
            "source_type": "linear_issue",
            "fetch_options": {
              "team": "ENG",
              "assignee": "@me"
            },
            "ready_action": {
              "type": "none"
            }
          }
        }
      }
    }
  ]
}
